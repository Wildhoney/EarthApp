!function(e){"use strict";e.module("earthApp",[])}(window.angular),function(e){"use strict";e.module("earthApp").controller("ApplicationController",["$scope",function(n){n.current={name:null},n.interface={setCountry:e.noop},n.setCountry=function(e){n.current.name=e,n.interface.setCountry(e)}}])}(window.angular),function(e,n,t){"use strict";n.directive("earth",["$window","$http","$cacheFactory",function(e,n,r){return{restrict:"E",require:"ngModel",scope:{model:"=ngModel"},controller:["$scope",function(n){n.options={},n.setOptions=function(e){n.options=e},n.getShader=function(n){return e.document.getElementById(n).textContent},n.addBigBen=function(e){var n=new THREE.Mesh(new THREE.BoxGeometry(10,10,10,new THREE.MeshNormalMaterial));return n.position.z=110,n.rotation.x=110,n.rotation.y=110,e.add(n),n},n.renderEarth=function(e){var t={},r=n.options.earth;return function(){var n=new THREE.MeshPhongMaterial({map:THREE.ImageUtils.loadTexture("images/earth_cloudy_diffuse.jpg"),bumpMap:THREE.ImageUtils.loadTexture("images/earth_normal.jpg"),bumpScale:.25}),i=new THREE.SphereGeometry(r.radius,r.segments,r.rings);t=new THREE.Mesh(i,n),e.add(t)}(),function(){var t=new THREE.ShaderMaterial({uniforms:{},vertexShader:n.getShader("vertexShader"),fragmentShader:n.getShader("fragmentShader"),side:THREE.BackSide,blending:THREE.AdditiveBlending,transparent:!0}),i=new THREE.SphereGeometry(r.radius+10,r.segments,r.rings),o=new THREE.Mesh(i,t);e.add(o)}(),t},n.renderLights=function(e){e.add(new THREE.AmbientLight(2236962)),function(){var t=n.options.light,r=new THREE.PointLight(16777215);r.intensity=.75,r.position.x=-100,r.position.y=50,r.position.z=t.z_position,r.castShadow=!0,e.add(r)}()}}],link:function(i,o){n.get("earth.yaml",{cache:r}).then(function(n){var r=t.load(n.data),a=r.scene,d=e.innerWidth/e.innerHeight,s=new THREE.WebGLRenderer({alpha:a.transparent,antialias:a.anti_alias}),u=new THREE.PerspectiveCamera(a.angle,d,a.near,a.far),c=new THREE.Scene;i.setOptions(r),c.add(u),u.position.z=r.camera.z_position,s.setSize(e.innerWidth,e.innerHeight),o.append(s.domElement);var l=i.renderEarth(c);i.renderLights(c),l.rotation.y=100,l.rotation.x=100,s.render(c,u),function h(){l.rotation.y+=5e-4,l.rotation.x+=1e-4,requestAnimationFrame(h),s.render(c,u)}()}),i.model={setCountry:function(e){console.log("Changing to",e,"...")}}}}}])}(window.angular,window.angular.module("earthApp"),window.jsyaml);