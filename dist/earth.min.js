!function(e){"use strict";e.module("earthApp",[])}(window.angular),function(e){"use strict";e.module("earthApp").controller("ApplicationController",["$scope",function(n){n.current={name:null},n.interface={setCountry:e.noop},n.setCountry=function(e){n.current.name=e,n.interface.setCountry(e)}}])}(window.angular),function(e,n,t){"use strict";n.directive("earth",["$window","$http","$cacheFactory",function(n,r,a){return{restrict:"E",require:"ngModel",scope:{model:"=ngModel"},controller:["$scope",function(t){THREE.Geometry.prototype.computeCentroids=e.noop,t.CONFIG_FILE="earth-app.yml",t.animationFrame=0,t.options={},t.setOptions=function(e){t.options=e},t.getShader=function(e){return n.document.getElementById(e).textContent},t.renderBigBen=function(e){var n=new THREE.ColladaLoader;n.load("models/BigBen.dae",function(n){n.scene.position.z=47.5,n.scene.position.x=10,n.scene.position.y=10,n.scene.rotation.x=-.2,n.scene.scale.x=.05,n.scene.scale.y=.05,n.scene.scale.z=.05,e.add(n.scene)})},t.renderClouds=function(e){var n=new THREE.Mesh,r=t.options.earth;return function(){var t=new THREE.MeshLambertMaterial({transparent:!0,opacity:0}),a=new THREE.SphereGeometry(r.radius,1,1);n=new THREE.Mesh(a,t),n.rotation.x=.2,n.rotation.y=.2,e.add(n)}(),function(){var e=t.options,r=new THREE.MeshPhongMaterial({map:THREE.ImageUtils.loadTexture(e.clouds.map),bumpMap:THREE.ImageUtils.loadTexture(e.clouds.bump_map),bumpScale:.35,transparent:!0,opacity:.3}),a=new THREE.SphereGeometry(e.earth.radius+.05,e.earth.segments,e.earth.rings),o=new THREE.Mesh(a,r);n.add(o)}(),n},t.renderEarth=function(e){var n=new THREE.Mesh,r=t.options.earth;return function(){var t=new THREE.MeshPhongMaterial({map:THREE.ImageUtils.loadTexture(r.map),bumpMap:THREE.ImageUtils.loadTexture(r.bump_map),bumpScale:r.bump_scale}),a=new THREE.SphereGeometry(r.radius,r.segments,r.rings);n=new THREE.Mesh(a,t),e.add(n)}(),function(){var n=new THREE.ShaderMaterial({uniforms:{},vertexShader:t.getShader("vertexShaderEarth"),fragmentShader:t.getShader("fragmentShaderEarth"),side:THREE.BackSide,blending:THREE.AdditiveBlending,transparent:!0}),a=new THREE.SphereGeometry(r.radius+10,r.segments,r.rings),o=new THREE.Mesh(a,n);e.add(o)}(),n},t.renderStars=function(e){for(var r=t.options.earth,a=new THREE.MeshLambertMaterial({transparent:!0,opacity:0}),o=new THREE.SphereGeometry(r.radius,1,1),i=new THREE.Mesh(o,a),s=t.options.stars.count,d=new THREE.Geometry,c=new THREE.ParticleBasicMaterial({size:2,map:THREE.ImageUtils.loadTexture("images/stars.png"),blending:THREE.AdditiveBlending,transparent:!0,opacity:.75}),E=0;s>E;E++){var p=2*Math.random()*n.innerWidth-250,u=2*Math.random()*n.innerWidth-250,l=1e3*Math.random()-1e3,m=new THREE.Vector3(p,u,l);d.vertices.push(m)}var h=new THREE.ParticleSystem(d,c);e.add(i),i.add(h)},t.renderLights=function(e){e.add(new THREE.AmbientLight(2236962)),function(){var n=t.options.light,r=new THREE.PointLight(16777215);r.intensity=1,r.position.x=-100,r.position.y=50,r.position.z=n.z_position,r.castShadow=!0,e.add(r)}()}}],link:function(e,o){r.get(e.CONFIG_FILE,{cache:a}).then(function(r){var a=t.load(r.data),i=a.scene,s=n.innerWidth/n.innerHeight,d=new THREE.WebGLRenderer({alpha:i.transparent,antialias:i.anti_alias}),c=new THREE.PerspectiveCamera(i.angle,s,i.near,i.far),E=new THREE.Scene;E.add(c),c.position.z=a.camera.z_position,d.setSize(n.innerWidth,n.innerHeight),o.append(d.domElement),e.setOptions(a);var p=e.renderEarth(E),u=e.renderClouds(E);e.renderLights(E),e.renderStars(E),d.render(E,c);var l=function m(){p.rotation.y+=5e-4,p.rotation.x+=1e-4,u.rotation.y+=.001,u.rotation.x+=1e-4,e.animationFrame=requestAnimationFrame(m),d.render(E,c)};l(),e.model={setCountry:function(e){var n={"United Kingdom":{y:4.7,x:1}},t=n[e].y/100,r=n[e].x/100,a=0;!function(){p.rotation.y+=t,p.rotation.x+=r;var o=p.rotation.y.toFixed(2)===n[e].y.toFixed(2),i=p.rotation.x.toFixed(2)===n[e].x.toFixed(2);return o&&i?(p.rotation.y=n[e].y,p.rotation.x=n[e].x,cancelAnimationFrame(a),void l()):(p.rotation.y=n[e].y,void(p.rotation.x=n[e].x))}()}}})}}}])}(window.angular,window.angular.module("earthApp"),window.jsyaml);