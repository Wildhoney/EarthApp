!function(e){"use strict";e.module("earthApp",[])}(window.angular),function(e,n,t){"use strict";n.directive("earth",["$window","$http","$cacheFactory",function(n,r,o){return{restrict:"E",require:"ngModel",scope:{model:"=ngModel"},controller:["$scope",function(t){THREE.Geometry.prototype.computeCentroids=e.noop,t.CONFIG_FILE="earth-app.yml",t.objects=[],t.animationFrame=0,t.isMouseDown=!1,t.options={},t.setOptions=function(e){t.options=e},t.getShader=function(e){return n.document.getElementById(e).textContent},t.renderTowerBridge=function(e){var n=new THREE.ColladaLoader;n.load("models/TowerBridge.dae",function(n){n.scene.position.z=47,n.scene.position.x=10,n.scene.position.y=10,n.scene.rotation.x=-.2,n.scene.scale.x=.025,n.scene.scale.y=.025,n.scene.scale.z=.025,e.add(n.scene)})},t.renderClouds=function(e){var n=new THREE.Mesh,r=t.options.earth;return function(){var t=new THREE.MeshLambertMaterial({transparent:!0,opacity:0}),o=new THREE.SphereGeometry(r.radius,1,1);n=new THREE.Mesh(o,t),n.rotation.x=.2,n.rotation.y=.2,e.add(n)}(),function(){var e=t.options,r=new THREE.MeshPhongMaterial({map:THREE.ImageUtils.loadTexture(e.clouds.map),bumpMap:THREE.ImageUtils.loadTexture(e.clouds.bump_map),bumpScale:.35,transparent:!0,opacity:.3}),o=new THREE.SphereGeometry(e.earth.radius+.05,e.earth.segments,e.earth.rings),i=new THREE.Mesh(o,r);n.add(i)}(),n},t.renderEarth=function(e){var n=new THREE.Mesh,r=t.options.earth;return function(){var o=new THREE.MeshPhongMaterial({map:THREE.ImageUtils.loadTexture(r.map),bumpMap:THREE.ImageUtils.loadTexture(r.bump_map),bumpScale:r.bump_scale}),i=new THREE.SphereGeometry(r.radius,r.segments,r.rings);n=new THREE.Mesh(i,o),t.objects.push(n),e.add(n)}(),function(){var n=new THREE.ShaderMaterial({uniforms:{},vertexShader:t.getShader("vertexShaderEarth"),fragmentShader:t.getShader("fragmentShaderEarth"),side:THREE.BackSide,blending:THREE.AdditiveBlending,transparent:!0}),o=new THREE.SphereGeometry(r.radius+10,r.segments,r.rings),i=new THREE.Mesh(o,n);e.add(i)}(),n},t.renderStars=function(e){for(var r=t.options.earth,o=new THREE.MeshLambertMaterial({transparent:!0,opacity:0}),i=new THREE.SphereGeometry(r.radius,1,1),a=new THREE.Mesh(i,o),s=t.options.stars.count,d=new THREE.Geometry,c=new THREE.ParticleBasicMaterial({size:2,map:THREE.ImageUtils.loadTexture("images/stars.png"),blending:THREE.AdditiveBlending,transparent:!0,opacity:.75}),u=0;s>u;u++){var E=2*Math.random()*n.innerWidth-250,p=2*Math.random()*n.innerWidth-250,l=1e3*Math.random()-1e3,h=new THREE.Vector3(E,p,l);d.vertices.push(h)}var m=new THREE.ParticleSystem(d,c);return e.add(a),a.add(m),a},t.renderLights=function(e){e.add(new THREE.AmbientLight(5592405)),function(){var n=t.options.light,r=new THREE.PointLight(16777215);r.intensity=1,r.position.x=-100,r.position.y=50,r.position.z=n.z_position,r.castShadow=!0,e.add(r)}()}}],link:function(e,i){var a=new THREE.Projector;r.get(e.CONFIG_FILE,{cache:o}).then(function(r){var o=t.load(r.data),s=o.scene,d=n.innerWidth/n.innerHeight,c=new THREE.WebGLRenderer({alpha:s.transparent,antialias:s.anti_alias}),u=new THREE.PerspectiveCamera(s.angle,d,s.near,s.far),E=new THREE.Scene;E.add(u),u.position.z=o.camera.z_position,c.setSize(n.innerWidth,n.innerHeight),i.append(c.domElement),e.setOptions(o);var p=e.renderEarth(E),l=e.renderClouds(E),h=e.renderStars(E);e.renderLights(E),c.render(E,u);var m=function w(){p.rotation.y+=5e-4,p.rotation.x+=1e-4,l.rotation.y+=.001,l.rotation.x+=1e-4,h.rotation.z+=5e-4,e.animationFrame=requestAnimationFrame(w),c.render(E,u)};m(),function(t){n.addEventListener("resize",function(){u.aspect=n.innerWidth/n.innerHeight,u.updateProjectionMatrix(),c.setSize(n.innerWidth,n.innerHeight)},!1);var r;t.addEventListener("mousedown",function(n){n.preventDefault();var t=new THREE.Vector3(n.clientX/window.innerWidth*2-1,2*-(n.clientY/window.innerHeight)+1,.5);a.unprojectVector(t,u);var o=new THREE.Raycaster(u.position,t.sub(u.position).normalize()),i=o.intersectObjects(e.objects);i.length>0&&i[0].object===p&&(r={x:n.clientX,y:n.clientY},e.isMouseDown=!0)}),t.addEventListener("mouseup",function(){e.isMouseDown=!1,r=null}),t.addEventListener("mousemove",function(e){if(r){var t=r.x-e.clientX,o=r.y-e.clientY,i=function(e){return{x:e.rotation.x+-(o/(3*n.innerWidth)),y:e.rotation.y+-(t/(3*n.innerHeight))}};p.rotation.y=i(p).y,p.rotation.x=i(p).x,l.rotation.y=i(l).y,l.rotation.x=i(l).x}})}(n.document),e.model={setCountry:function(e){var n={"United Kingdom":{y:4.7,x:1}},t=n[e].y/100,r=n[e].x/100,o=0;!function(){p.rotation.y+=t,p.rotation.x+=r;var i=p.rotation.y.toFixed(2)===n[e].y.toFixed(2),a=p.rotation.x.toFixed(2)===n[e].x.toFixed(2);return i&&a?(p.rotation.y=n[e].y,p.rotation.x=n[e].x,cancelAnimationFrame(o),void m()):(p.rotation.y=n[e].y,void(p.rotation.x=n[e].x))}()}}})}}}])}(window.angular,window.angular.module("earthApp"),window.jsyaml),function(e){"use strict";e.module("earthApp").controller("ApplicationController",["$scope",function(n){n.current={name:null},n.interface={setCountry:e.noop},n.setCountry=function(e){n.current.name=e,n.interface.setCountry(e)}}])}(window.angular);