!function(e){"use strict";e.module("earthApp",[])}(window.angular),function(e){"use strict";e.module("earthApp").controller("ApplicationController",["$scope",function(n){n.current={name:null},n.interface={setCountry:e.noop},n.setCountry=function(e){n.current.name=e,n.interface.setCountry(e)}}])}(window.angular),function(e,n,t){"use strict";n.directive("earth",["$window","$http","$cacheFactory",function(n,r,i){return{restrict:"E",require:"ngModel",scope:{model:"=ngModel"},controller:["$scope",function(t){THREE.Geometry.prototype.computeCentroids=e.noop,t.CONFIG_FILE="earth-app.yml",t.objects=[],t.animationFrame=0,t.isMouseDown=!1,t.options={},t.setOptions=function(e){t.options=e},t.getShader=function(e){return n.document.getElementById(e).textContent},t.renderTowerBridge=function(e){var n=new THREE.ColladaLoader;n.load("models/TowerBridge.dae",function(n){n.scene.position.z=47,n.scene.position.x=10,n.scene.position.y=10,n.scene.rotation.x=-.2,n.scene.scale.x=.025,n.scene.scale.y=.025,n.scene.scale.z=.025,e.add(n.scene)})},t.renderClouds=function(e){var n=new THREE.Mesh,r=t.options.earth;return function(){var t=new THREE.MeshLambertMaterial({transparent:!0,opacity:0}),i=new THREE.SphereGeometry(r.radius,1,1);n=new THREE.Mesh(i,t),n.rotation.x=.2,n.rotation.y=.2,e.add(n)}(),function(){var e=t.options,r=new THREE.MeshPhongMaterial({map:THREE.ImageUtils.loadTexture(e.clouds.map),bumpMap:THREE.ImageUtils.loadTexture(e.clouds.bump_map),bumpScale:.35,transparent:!0,opacity:.3}),i=new THREE.SphereGeometry(e.earth.radius+.05,e.earth.segments,e.earth.rings),o=new THREE.Mesh(i,r);n.add(o)}(),n},t.renderEarth=function(e){var n=new THREE.Mesh,r=t.options.earth;return function(){var i=new THREE.MeshPhongMaterial({map:THREE.ImageUtils.loadTexture(r.map),bumpMap:THREE.ImageUtils.loadTexture(r.bump_map),bumpScale:r.bump_scale}),o=new THREE.SphereGeometry(r.radius,r.segments,r.rings);n=new THREE.Mesh(o,i),t.objects.push(n),e.add(n)}(),function(){var n=new THREE.ShaderMaterial({uniforms:{},vertexShader:t.getShader("vertexShaderEarth"),fragmentShader:t.getShader("fragmentShaderEarth"),side:THREE.BackSide,blending:THREE.AdditiveBlending,transparent:!0}),i=new THREE.SphereGeometry(r.radius+10,r.segments,r.rings),o=new THREE.Mesh(i,n);e.add(o)}(),n},t.renderStars=function(e){for(var r=t.options.stars,i=new THREE.MeshLambertMaterial({transparent:!0,opacity:0}),o=new THREE.SphereGeometry(t.options.earth.radius,1,1),a=new THREE.Mesh(o,i),s=n.Math.random,d=new THREE.Geometry,c=new THREE.ParticleBasicMaterial({map:THREE.ImageUtils.loadTexture(r.material),size:r.diameter,blending:THREE.AdditiveBlending,opacity:r.opacity,transparent:!0}),u=0;u<t.options.stars.count;u++){var E=2*s()*n.innerWidth-250,p=2*s()*n.innerWidth-250,l=1e3*s()-1e3,m=new THREE.Vector3(E,p,l);d.vertices.push(m)}var h=new THREE.ParticleSystem(d,c);return e.add(a),a.add(h),a},t.renderLights=function(e){e.add(new THREE.AmbientLight(5592405)),function(){var n=t.options.light,r=new THREE.PointLight(16777215);r.intensity=1,r.position.x=-100,r.position.y=50,r.position.z=n.z_position,r.castShadow=!0,e.add(r)}()}}],link:function(e,o){var a=new THREE.Projector;r.get(e.CONFIG_FILE,{cache:i}).then(function(r){var i=t.load(r.data),s=i.scene,d=n.innerWidth/n.innerHeight,c=new THREE.WebGLRenderer({alpha:s.transparent,antialias:s.anti_alias}),u=new THREE.PerspectiveCamera(s.angle,d,s.near,s.far),E=new THREE.Scene;E.add(u),u.position.z=i.camera.z_position,c.setSize(n.innerWidth,n.innerHeight),o.append(c.domElement),e.setOptions(i);var p=e.renderEarth(E),l=e.renderClouds(E),m=e.renderStars(E);e.renderLights(E),c.render(E,u);var h=function w(){p.rotation.y+=5e-4,p.rotation.x+=1e-4,l.rotation.y+=.001,l.rotation.x+=1e-4,m.rotation.z+=5e-4,e.animationFrame=requestAnimationFrame(w),c.render(E,u)};h(),function(t){n.addEventListener("resize",function(){u.aspect=n.innerWidth/n.innerHeight,u.updateProjectionMatrix(),c.setSize(n.innerWidth,n.innerHeight)},!1);var r;t.addEventListener("mousedown",function(n){n.preventDefault();var t=new THREE.Vector3(n.clientX/window.innerWidth*2-1,2*-(n.clientY/window.innerHeight)+1,.5);a.unprojectVector(t,u);var i=new THREE.Raycaster(u.position,t.sub(u.position).normalize()),o=i.intersectObjects(e.objects);o.length>0&&o[0].object===p&&(r={x:n.clientX,y:n.clientY},e.isMouseDown=!0)}),t.addEventListener("mouseup",function(){e.isMouseDown=!1,r=null}),t.addEventListener("mousemove",function(e){if(r){var t=r.x-e.clientX,i=r.y-e.clientY,o=function(e){return{x:e.rotation.x+-(i/(3*n.innerWidth)),y:e.rotation.y+-(t/(3*n.innerHeight))}};p.rotation.y=o(p).y,p.rotation.x=o(p).x,l.rotation.y=o(l).y,l.rotation.x=o(l).x}})}(n.document),e.model={setCountry:function(e){var n={"United Kingdom":{y:4.7,x:1}},t=n[e].y/100,r=n[e].x/100,i=0;!function(){p.rotation.y+=t,p.rotation.x+=r;var o=p.rotation.y.toFixed(2)===n[e].y.toFixed(2),a=p.rotation.x.toFixed(2)===n[e].x.toFixed(2);return o&&a?(p.rotation.y=n[e].y,p.rotation.x=n[e].x,cancelAnimationFrame(i),void h()):(p.rotation.y=n[e].y,void(p.rotation.x=n[e].x))}()}}})}}}])}(window.angular,window.angular.module("earthApp"),window.jsyaml);